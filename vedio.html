<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<style type="text/css">
			* {
				margin: 0;
				padding: 0;
			}
			
			body {
				background-color: #bbb;
			}
			
			#video {
				margin: 0 auto;
				position: relative;
				width: 610px;
				height: 450px;
				background-color: #fff;
				border-radius: 20px;
			}
			
			#video #title {
				height: 20px;
				position: absolute;
				text-align: center;
				line-height: 20px;
				left: 250px;
			}
			
			#video video {
				position: absolute;
				background-color: #999;
				top: 30px;
			}
			
			#video #title #getPic {
				position: absolute;
				left: -230px;
				top: 2px;
				width: 80px;
			}
			
			#video #open {
				position: absolute;
				left: 10px;
				top: 420px;
			}
			
			#myCanvas {
				position: absolute;
				left: 410px;
				border: 1px solid royalblue;
				border-radius: 20px;
			}
		</style>
	</head>

	<body>
		<div id="video">
			<div id="title">
				<span id="">
					indeex live video
				</span>
				<span id="getPic"> <a href="javascript:getPicture();">截图</a> </span>
			</div>
			<video width="610" height="380" id="myVideo" autoplay>
				你的浏览器不支持Video！
			</video>
			<div id="open">
				<a href="javascript:openCamera();"> 打开摄像头</a>
			</div>
		</div>
		<canvas id="myCanvas" width="610" height="450">
			你的浏览器不支持canvas!
		</canvas>
		
		<input type="text" name="ipt" id="ipt" value="" />
		<div id="div"></div>
		<!--<script type="text/javascript" src="qr/grid.js"></script>
		<script type="text/javascript" src="qr/version.js"></script>
		<script type="text/javascript" src="qr/detector.js"></script>
		<script type="text/javascript" src="qr/formatinf.js"></script>
		<script type="text/javascript" src="qr/errorlevel.js"></script>
		<script type="text/javascript" src="qr/bitmat.js"></script>
		<script type="text/javascript" src="qr/datablock.js"></script>
		<script type="text/javascript" src="qr/bmparser.js"></script>
		<script type="text/javascript" src="qr/datamask.js"></script>
		<script type="text/javascript" src="qr/rsdecoder.js"></script>
		<script type="text/javascript" src="qr/gf256poly.js"></script>
		<script type="text/javascript" src="qr/gf256.js"></script>
		<script type="text/javascript" src="qr/decoder.js"></script>
		<script type="text/javascript" src="qr/qrcode.js"></script>
		<script type="text/javascript" src="qr/findpat.js"></script>
		<script type="text/javascript" src="qr/alignpat.js"></script>
		<script type="text/javascript" src="qr/databr.js"></script>-->
		
		
		<script src="lib/qrcode.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			var myVideo = document.getElementById("myVideo");
			var myCanvas = document.getElementById("myCanvas");
			var ipt = document.getElementById("ipt");
			var div = document.getElementById("div");
			var ctx = myCanvas.getContext("2d");

			window.navigator.getUserMedia = window.navigator.getUserMedia ||
				window.navigator.mozGetUserMedia ||
				window.navigator.webkitGetUserMedia ||
				window.navigator.msGetUserMedia;

			function openCamera() {
				if(window.navigator.getUserMedia) {
					window.navigator.getUserMedia({
						"video": true,
						"audio": true
					}, successFun, errorFun);
				} else {
					alert("你的浏览器不支持开启摄像头！");
				}
			}

			window.URL = window.URL ||
				window.mozURL ||
				window.webkitURL ||
				window.msURL;

			function successFun(stream) {
				if(myVideo.mozSrcObject !== undefined) {
					myVideo.mozSrcObject = stream;
				} else {
					myVideo.src = window.URL ? window.URL.createObjectURL(stream) : stream;
				}
			}

			function errorFun(err) {
				alert(err);
			}

			function getPicture() {
				ctx.drawImage(myVideo, 0, 0);
				canvasToImage(myCanvas);
				getQr();
			}

			function getQr() {
				qrcode.decode(window.location.href);
			}

			function canvasToImage(canvas) {
				var type = "image/png";
				var dataurl = ctx.canvas.toDataURL(type).replace("image/png", "image/octet-stream");
				window.location.href = dataurl;
			}
			
			var qrcode = new QRCode(document.getElementById("div"), {
	width : 200,
	height : 200
});
			ipt.onblur = function(){
				qrcode.makeCode(ipt.value);
			}
		</script>
	</body>

</html>
